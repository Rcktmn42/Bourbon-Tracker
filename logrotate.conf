# Logrotate configuration for NC Bourbon Tracker
# Place this file in: /etc/logrotate.d/bourbon-tracker

# Application logs (PM2)
/var/log/bourbon-tracker/*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    copytruncate
    su root root
    create 0644 root root
    
    # Restart PM2 after rotation to ensure proper log handling
    postrotate
        /usr/bin/pm2 reloadLogs > /dev/null 2>&1 || true
    endscript
}

# Nginx logs
/var/log/nginx/bourbon-tracker.*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0644 www-data www-data
    sharedscripts
    
    # Reload nginx to reopen log files
    postrotate
        /bin/kill -USR1 $(cat /var/run/nginx.pid 2>/dev/null) 2>/dev/null || true
    endscript
}